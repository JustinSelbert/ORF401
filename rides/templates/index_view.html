{% extends "base.html" %}

{% block content %}
<section class="search-panel">
  <p class="eyebrow">Ride Search</p>
  <h2 class="panel-title">Find a route. Meet someone worth knowing.</h2>
  <p class="panel-subtitle">
    Search by route, rider, city, or state. Add filters and find the right people, not just the nearest car.
  </p>

  <form action="{% url 'rides:index' %}" method="get" class="search-form" onsubmit="return checkForm();">
    <div class="form-row form-row-wide">
      <label for="{{ form.search.id_for_label }}">Keywords</label>
      {{ form.search }}
    </div>

    <div class="form-row">
      <label for="{{ form.travel_date.id_for_label }}">Travel date</label>
      {{ form.travel_date }}
    </div>

    <div class="form-row">
      <label for="{{ form.minimum_seats.id_for_label }}">Minimum seats</label>
      {{ form.minimum_seats }}
    </div>

    <div class="form-row checkbox-row">
      <label for="{{ form.passengers_only.id_for_label }}">{{ form.passengers_only }} {{ form.passengers_only.label }}</label>
    </div>

    <button type="submit">Find Matches</button>
  </form>

  <div class="hint-row">
    <button class="hint-chip" type="button" data-search-hint="Austin Dallas">Austin Dallas</button>
    <button class="hint-chip" type="button" data-search-hint="Seattle WA">Seattle WA</button>
    <button class="hint-chip" type="button" data-search-hint="San Jose CA">San Jose CA</button>
    <button class="hint-chip" type="button" data-search-hint="Miami Orlando">Miami Orlando</button>
  </div>
</section>

<section class="results-panel">
  <div class="results-head">
    <h3>Best Available Matches</h3>
    {% if search_executed %}
    <p class="results-meta">{{ match_count }} match{{ match_count|pluralize }} found</p>
    {% endif %}
  </div>

  {% if not search_executed %}
    <p class="empty-state">Run a search to discover your next friend, collaborator, or spark.</p>
  {% elif people %}
    <div class="result-card-grid">
      {% for person in people %}
      <article class="result-card">
        <div class="result-card-head">
          <h4><a class="rider-link" href="{% url 'rides:rider_profile' person.id %}">{{ person.first_name }}</a></h4>
          {% if person.taking_passengers %}
          <span class="pill pill-yes">Open</span>
          {% else %}
          <span class="pill pill-no">Closed</span>
          {% endif %}
        </div>
        <p><strong>Occupation:</strong> {{ person.occupation|default:"Not shared" }}</p>
        <p><strong>Looking for:</strong> {{ person.looking_for|default:"Connection" }}</p>
        <p><strong>Interests:</strong> {{ person.interests|default:"Not shared" }}</p>
        <p><strong>Route:</strong> {{ person.origination }} to {{ person.destination_city }}, {{ person.destination_state }}</p>
        <p><strong>Departure:</strong> {{ person.date }} at {{ person.time }}</p>
        <p><strong>Seats:</strong> {{ person.seats_available }}</p>
        <p><a class="inline-link" href="{% url 'rides:ride_profile' person.id %}">View full profile</a></p>
      </article>
      {% endfor %}
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Origination</th>
            <th>Destination</th>
            <th>Date</th>
            <th>Time</th>
            <th>Taking Passengers</th>
            <th>Seats Available</th>
          </tr>
        </thead>
        <tbody>
          {% for person in people %}
          <tr>
            <td><a class="rider-link" href="{% url 'rides:rider_profile' person.id %}"><strong>{{ person.first_name }}</strong></a></td>
            <td>{{ person.origination }}</td>
            <td>{{ person.destination_city }}, {{ person.destination_state }}</td>
            <td>{{ person.date }}</td>
            <td>{{ person.time }}</td>
            <td>
              {% if person.taking_passengers %}
                <span class="pill pill-yes">Yes</span>
              {% else %}
                <span class="pill pill-no">No</span>
              {% endif %}
            </td>
            <td>{{ person.seats_available }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="empty-state">No matches yet. Try broader filters and spark more possibilities.</p>
  {% endif %}
</section>
{% endblock %}
